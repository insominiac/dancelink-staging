generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SeatLockItemType {
  CLASS
  EVENT
}

enum SeatLockStatus {
  ACTIVE
  RELEASED
  CANCELLED
  EXPIRED
}

model SeatLock {
  id         String           @id @default(cuid())
  itemType   SeatLockItemType
  itemId     String
  userId     String?
  quantity   Int              @default(1)
  status     SeatLockStatus   @default(ACTIVE)
  expiresAt  DateTime
  createdAt  DateTime         @default(now())
  updatedAt  DateTime         @updatedAt
  releasedAt DateTime?
  bookingId  String?

  @@index([itemType, itemId])
  @@index([status, expiresAt])
  @@index([bookingId])
  @@map("seat_locks")
}

model User {
  id                 String              @id @default(cuid())
  email              String              @unique
  passwordHash       String              @map("password_hash")
  fullName           String              @map("full_name")
  phone              String?
  role               UserRole            @default(USER)
  bio                String?
  profileImage       String?             @map("profile_image")
  isVerified         Boolean             @default(false) @map("is_verified")
  websiteUrl         String?             @map("website_url")
  instagramHandle    String?             @map("instagram_handle")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  auditLogs          AuditLog[]
  bookings           Booking[]
  attendance         ClassAttendance[]
  organizedEvents    Event[]
  forumPosts         ForumPost[]
  forumReplies       ForumReply[]
  approvedHosts      Host[]              @relation("ApprovedHosts")
  instructor         Instructor?
  loginAttempts      LoginAttempt[]
  createdLoginTokens LoginToken[]        @relation("CreatedLoginTokens")
  notifications      Notification[]
  sessions           Session[]
  engagement         StudentEngagement[]
  feedback           StudentFeedback[]
  testimonials       Testimonial[]
  transactions       Transaction[]
  partnerProfile     UserProfile?
  userStyles         UserStyle[]
  host               Host?

  @@index([role])
  @@index([createdAt])
  @@map("users")
}

model Instructor {
  id                 String                  @id @default(cuid())
  userId             String                  @unique @map("user_id")
  specialty          String?
  experienceYears    Int?                    @map("experience_years")
  rating             Decimal?                @db.Decimal(3, 2)
  isActive           Boolean                 @default(true) @map("is_active")
  createdAt          DateTime                @default(now()) @map("created_at")
  updatedAt          DateTime                @updatedAt @map("updated_at")
  classAnalytics     ClassAnalytics[]
  attendanceRecords  ClassAttendance[]
  classInstructors   ClassInstructor[]
  performanceMetrics InstructorPerformance[]
  user               User                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  studentEngagement  StudentEngagement[]
  feedbackReceived   StudentFeedback[]

  @@index([userId])
  @@map("instructors")
}

model Class {
  id               String              @id @default(cuid())
  title            String
  description      String
  level            String
  durationMins     Int                 @map("duration_mins")
  maxCapacity      Int                 @map("max_capacity")
  price            Decimal             @db.Decimal(10, 2)
  scheduleDays     String?             @map("schedule_days")
  scheduleTime     String?             @map("schedule_time")
  requirements     String?
  imageUrl         String?             @map("image_url")
  isActive         Boolean             @default(true) @map("is_active")
  createdAt        DateTime            @default(now()) @map("created_at")
  updatedAt        DateTime            @updatedAt @map("updated_at")
  endDate          DateTime?           @map("end_date")
  startDate        DateTime?           @map("start_date")
  venueId          String?             @map("venue_id")
  status           ClassStatus         @default(DRAFT)
  bookings         Booking[]
  analytics        ClassAnalytics[]
  attendance       ClassAttendance[]
  classInstructors ClassInstructor[]
  classStyles      ClassStyle[]
  venue            Venue?              @relation(fields: [venueId], references: [id])
  engagement       StudentEngagement[]
  feedback         StudentFeedback[]
  host             Host?               @relation("HostClasses", fields: [hostId], references: [id])
  hostId           String?             @map("host_id")

  @@index([createdAt])
  @@index([isActive])
  @@index([startDate])
  @@index([venueId])
  @@index([status])
  @@map("classes")
}

model Event {
  id               String       @id @default(cuid())
  title            String
  description      String
  eventType        String       @map("event_type")
  startDate        DateTime     @map("start_date")
  endDate          DateTime     @map("end_date")
  startTime        String       @map("start_time")
  endTime          String       @map("end_time")
  venueId          String       @map("venue_id")
  price            Decimal      @db.Decimal(10, 2)
  maxAttendees     Int          @map("max_attendees")
  currentAttendees Int          @default(0) @map("current_attendees")
  imageUrl         String?      @map("image_url")
  organizerUserId  String?      @map("organizer_user_id")
  status           EventStatus  @default(DRAFT)
  isFeatured       Boolean      @default(false) @map("is_featured")
  createdAt        DateTime     @default(now()) @map("created_at")
  updatedAt        DateTime     @updatedAt @map("updated_at")
  bookings         Booking[]
  eventStyles      EventStyle[]
  organizer        User?        @relation(fields: [organizerUserId], references: [id])
  venue            Venue        @relation(fields: [venueId], references: [id])
  host             Host?        @relation("HostEvents", fields: [hostId], references: [id])
  hostId           String?      @map("host_id")

  @@index([venueId])
  @@index([startDate, startTime])
  @@index([status])
  @@map("events")
}

model Venue {
  id           String   @id @default(cuid())
  name         String
  addressLine1 String   @map("address_line1")
  addressLine2 String?  @map("address_line2")
  city         String
  state        String
  country      String
  postalCode   String   @map("postal_code")
  latitude     Decimal? @db.Decimal(9, 6)
  longitude    Decimal? @db.Decimal(9, 6)
  phone        String?
  websiteUrl   String?  @map("website_url")
  status       VenueStatus @default(DRAFT)
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  classes      Class[]
  events       Event[]
  host         Host?   @relation("HostVenues", fields: [hostId], references: [id])
  hostId       String? @map("host_id")
  competitionRequests CompetitionRequest[]

  @@index([name])
  @@index([city])
  @@index([country])
  @@map("venues")
}

// New models for Host features
model Academy {
  id        String      @id @default(cuid())
  hostId    String      @map("host_id")
  name      String
  description String?
  website   String?
  city      String?
  country   String?
  logoUrl   String?     @map("logo_url")
  status    VenueStatus @default(PENDING_APPROVAL)
  createdAt DateTime    @default(now()) @map("created_at")
  updatedAt DateTime    @updatedAt @map("updated_at")

  host      Host        @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([hostId])
  @@index([status])
  @@map("academies")
}

model CompetitionRequest {
  id                    String                     @id @default(cuid())
  hostId                String                     @map("host_id")
  name                  String
  startDate             DateTime                   @map("start_date")
  endDate               DateTime                   @map("end_date")
  venueId               String?                    @map("venue_id")
  description           String?
  expectedParticipants  Int?                       @map("expected_participants")
  status                CompetitionRequestStatus   @default(PENDING)
  createdAt             DateTime                   @default(now()) @map("created_at")
  updatedAt             DateTime                   @updatedAt @map("updated_at")

  host                  Host                       @relation(fields: [hostId], references: [id], onDelete: Cascade)
  venue                 Venue?                     @relation(fields: [venueId], references: [id])

  @@index([hostId])
  @@index([status])
  @@map("competition_requests")
}

model ClassInstructor {
  id           String     @id @default(cuid())
  classId      String     @map("class_id")
  instructorId String     @map("instructor_id")
  isPrimary    Boolean    @default(false) @map("is_primary")
  createdAt    DateTime   @default(now()) @map("created_at")
  updatedAt    DateTime   @updatedAt @map("updated_at")
  class        Class      @relation(fields: [classId], references: [id], onDelete: Cascade)
  instructor   Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)

  @@unique([classId, instructorId])
  @@map("class_instructors")
}

model Booking {
  id               String             @id @default(cuid())
  userId           String             @map("user_id")
  classId          String?            @map("class_id")
  eventId          String?            @map("event_id")
  bookingDate      DateTime           @default(now()) @map("booking_date")
  status           BookingStatus      @default(PENDING)
  amountPaid       Decimal            @map("amount_paid") @db.Decimal(10, 2)
  paymentMethod    String?            @map("payment_method")
  notes            String?
  createdAt        DateTime           @default(now()) @map("created_at")
  updatedAt        DateTime           @updatedAt @map("updated_at")
  confirmationCode String?            @map("confirmation_code")
  discountAmount   Decimal            @default(0) @map("discount_amount") @db.Decimal(10, 2)
  paymentStatus    String             @default("pending") @map("payment_status")
  stripeSessionId  String?            @map("stripe_session_id")
  taxAmount        Decimal            @default(0) @map("tax_amount") @db.Decimal(10, 2)
  totalAmount      Decimal            @default(0) @map("total_amount") @db.Decimal(10, 2)
  class            Class?             @relation(fields: [classId], references: [id], onDelete: Cascade)
  event            Event?             @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user             User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  attendance       ClassAttendance?   @relation("BookingAttendance")
  engagement       StudentEngagement? @relation("BookingEngagement")
  feedback         StudentFeedback?   @relation("BookingFeedback")
  transactions     Transaction[]

  @@index([userId])
  @@index([createdAt])
  @@index([status])
  @@index([paymentStatus])
  @@index([stripeSessionId])
  @@map("bookings")
}

model Transaction {
  id                String            @id @default(cuid())
  bookingId         String?           @map("booking_id")
  userId            String            @map("user_id")
  provider          PaymentProvider
  providerPaymentId String?           @map("provider_payment_id")
  providerRefundId  String?           @map("provider_refund_id")
  type              TransactionType
  status            TransactionStatus @default(CREATED)
  amount            Decimal           @db.Decimal(10, 2)
  currency          String            @default("USD")
  payload           String?
  createdAt         DateTime          @default(now()) @map("created_at")
  updatedAt         DateTime          @updatedAt @map("updated_at")
  brand             String?
  failureReason     String?           @map("failure_reason")
  last4             String?           @map("last_4")
  paymentMethodType String?           @map("payment_method_type")
  stripeSessionId   String?           @map("stripe_session_id")
  booking           Booking?          @relation(fields: [bookingId], references: [id])
  user              User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerPaymentId])
  @@index([stripeSessionId])
  @@map("transactions")
}

model DanceStyle {
  id              String                  @id @default(cuid())
  name            String                  @unique
  category        String?
  isActive        Boolean                 @default(true) @map("is_active")
  createdAt       DateTime                @default(now()) @map("created_at")
  updatedAt       DateTime                @updatedAt @map("updated_at")
  benefits        String?
  characteristics String?
  description     String?
  difficulty      String?
  icon            String?
  image           String?
  instructors     String?
  isFeatured      Boolean                 @default(false) @map("is_featured")
  musicStyle      String?
  origin          String?
  price           String?
  schedule        String?
  sortOrder       Int?                    @map("sort_order")
  subtitle        String?
  videoUrl        String?                 @map("video_url")
  classStyles     ClassStyle[]
  eventStyles     EventStyle[]
  profileStyles   UserProfileDanceStyle[]
  userStyles      UserStyle[]

  @@index([isActive])
  @@index([isFeatured])
  @@index([sortOrder])
  @@map("dance_styles")
}

model UserStyle {
  id          String      @id @default(cuid())
  userId      String      @map("user_id")
  styleId     String      @map("style_id")
  proficiency Proficiency @default(BEGINNER)
  createdAt   DateTime    @default(now()) @map("created_at")
  updatedAt   DateTime    @updatedAt @map("updated_at")
  style       DanceStyle  @relation(fields: [styleId], references: [id])
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, styleId])
  @@map("user_styles")
}

model ClassStyle {
  id        String     @id @default(cuid())
  classId   String     @map("class_id")
  styleId   String     @map("style_id")
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  class     Class      @relation(fields: [classId], references: [id], onDelete: Cascade)
  style     DanceStyle @relation(fields: [styleId], references: [id])

  @@unique([classId, styleId])
  @@map("class_styles")
}

model EventStyle {
  id        String     @id @default(cuid())
  eventId   String     @map("event_id")
  styleId   String     @map("style_id")
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")
  event     Event      @relation(fields: [eventId], references: [id], onDelete: Cascade)
  style     DanceStyle @relation(fields: [styleId], references: [id])

  @@unique([eventId, styleId])
  @@map("event_styles")
}

model ForumPost {
  id           String       @id @default(cuid())
  userId       String       @map("user_id")
  category     String
  title        String
  content      String
  viewsCount   Int          @default(0) @map("views_count")
  likesCount   Int          @default(0) @map("likes_count")
  repliesCount Int          @default(0) @map("replies_count")
  isPinned     Boolean      @default(false) @map("is_pinned")
  isLocked     Boolean      @default(false) @map("is_locked")
  createdAt    DateTime     @default(now()) @map("created_at")
  updatedAt    DateTime     @updatedAt @map("updated_at")
  user         User         @relation(fields: [userId], references: [id], onDelete: SetNull)
  replies      ForumReply[]

  @@index([createdAt])
  @@map("forum_posts")
}

model ForumReply {
  id         String       @id @default(cuid())
  postId     String       @map("post_id")
  userId     String       @map("user_id")
  parentId   String?      @map("parent_id")
  content    String
  likesCount Int          @default(0) @map("likes_count")
  isSolution Boolean      @default(false) @map("is_solution")
  createdAt  DateTime     @default(now()) @map("created_at")
  updatedAt  DateTime     @updatedAt @map("updated_at")
  parent     ForumReply?  @relation("ReplyToReply", fields: [parentId], references: [id], onDelete: Cascade)
  replies    ForumReply[] @relation("ReplyToReply")
  post       ForumPost    @relation(fields: [postId], references: [id], onDelete: Cascade)
  user       User         @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([createdAt])
  @@map("forum_replies")
}

model Notification {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  type      String
  title     String
  message   String
  isRead    Boolean  @default(false) @map("is_read")
  priority  String   @default("normal")
  actionUrl String?  @map("action_url")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}

model NotificationTemplate {
  id         String   @id @default(cuid())
  name       String   @unique
  title      String
  message    String
  type       String
  priority   String   @default("NORMAL")
  isActive   Boolean  @default(true) @map("is_active")
  usageCount Int      @default(0) @map("usage_count")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("notification_templates")
}

model Session {
  id             String   @id @default(cuid())
  userId         String   @map("user_id")
  userRole       UserRole @map("user_role")
  deviceId       String   @map("device_id")
  deviceInfo     String?  @map("device_info")
  ipAddress      String   @map("ip_address")
  userAgent      String?  @map("user_agent")
  isActive       Boolean  @default(true) @map("is_active")
  lastAccessedAt DateTime @default(now()) @map("last_accessed_at")
  expiresAt      DateTime @map("expires_at")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([deviceId, userRole])
  @@index([userId])
  @@index([deviceId])
  @@index([isActive])
  @@index([expiresAt])
  @@map("sessions")
}

model AuditLog {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  action    String
  tableName String   @map("table_name")
  recordId  String   @map("record_id")
  oldValues String?  @map("old_values")
  newValues String?  @map("new_values")
  ipAddress String?  @map("ip_address")
  userAgent String?  @map("user_agent")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("audit_logs")
}

model ContactMessage {
  id            String   @id @default(cuid())
  name          String
  email         String
  phone         String?
  subject       String
  message       String
  isRead        Boolean  @default(false) @map("is_read")
  adminResponse String?  @map("admin_response")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  @@map("contact_messages")
}

model Testimonial {
  id         String   @id @default(cuid())
  userId     String   @map("user_id")
  rating     Int
  message    String
  isFeatured Boolean  @default(false) @map("is_featured")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("testimonials")
}

model UserProfile {
  id                  String                  @id @default(cuid())
  userId              String                  @unique @map("user_id")
  bio                 String?
  location            String?
  latitude            Decimal?                @db.Decimal(9, 6)
  longitude           Decimal?                @db.Decimal(9, 6)
  experienceLevel     ExperienceLevel         @default(BEGINNER) @map("experience_level")
  lookingFor          PartnerLookingFor[]     @map("looking_for")
  ageRange            String?                 @map("age_range")
  profilePicture      String?                 @map("profile_picture")
  isActiveForMatching Boolean                 @default(true) @map("is_active_for_matching")
  lastActiveAt        DateTime                @default(now()) @map("last_active_at")
  createdAt           DateTime                @default(now()) @map("created_at")
  updatedAt           DateTime                @updatedAt @map("updated_at")
  receivedRequests    MatchRequest[]          @relation("ReceivedRequests")
  sentRequests        MatchRequest[]          @relation("SentRequests")
  danceStyles         UserProfileDanceStyle[]
  user                User                    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([location])
  @@index([experienceLevel])
  @@index([isActiveForMatching])
  @@index([lastActiveAt])
  @@map("user_profiles")
}

model UserProfileDanceStyle {
  id        String          @id @default(cuid())
  profileId String          @map("profile_id")
  styleId   String          @map("style_id")
  level     ExperienceLevel
  createdAt DateTime        @default(now()) @map("created_at")
  profile   UserProfile     @relation(fields: [profileId], references: [id], onDelete: Cascade)
  style     DanceStyle      @relation(fields: [styleId], references: [id])

  @@unique([profileId, styleId])
  @@map("user_profile_dance_styles")
}

model MatchRequest {
  id          String      @id @default(cuid())
  senderId    String      @map("sender_id")
  receiverId  String      @map("receiver_id")
  status      MatchStatus @default(PENDING)
  message     String?
  createdAt   DateTime    @default(now()) @map("created_at")
  respondedAt DateTime?   @map("responded_at")
  expiresAt   DateTime    @map("expires_at")
  receiver    UserProfile @relation("ReceivedRequests", fields: [receiverId], references: [id], onDelete: Cascade)
  sender      UserProfile @relation("SentRequests", fields: [senderId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([status])
  @@index([createdAt])
  @@index([expiresAt])
  @@map("match_requests")
}

model Match {
  id          String    @id @default(cuid())
  user1Id     String    @map("user1_id")
  user2Id     String    @map("user2_id")
  matchScore  Float     @default(0) @map("match_score")
  createdAt   DateTime  @default(now()) @map("created_at")
  isActive    Boolean   @default(true) @map("is_active")
  unmatchedAt DateTime? @map("unmatched_at")
  unmatchedBy String?   @map("unmatched_by")

  @@unique([user1Id, user2Id])
  @@index([isActive])
  @@index([createdAt])
  @@map("matches")
}

model SeoPage {
  id                 String   @id @default(cuid())
  path               String   @unique
  title              String?
  description        String?
  keywords           String?
  author             String?
  robots             String?
  canonical          String?
  ogTitle            String?  @map("og_title")
  ogDescription      String?  @map("og_description")
  ogImage            String?  @map("og_image")
  ogType             String?  @map("og_type")
  ogUrl              String?  @map("og_url")
  twitterCard        String?  @map("twitter_card")
  twitterTitle       String?  @map("twitter_title")
  twitterDescription String?  @map("twitter_description")
  twitterImage       String?  @map("twitter_image")
  twitterCreator     String?  @map("twitter_creator")
  structuredData     String?  @map("structured_data")
  customMeta         String?  @map("custom_meta")
  isActive           Boolean  @default(true) @map("is_active")
  priority           Int      @default(5)
  lastModified       DateTime @default(now()) @map("last_modified")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")

  @@index([path])
  @@index([isActive])
  @@index([priority])
  @@map("seo_pages")
}

model ClassAttendance {
  id           String           @id @default(cuid())
  bookingId    String           @unique @map("booking_id")
  classId      String           @map("class_id")
  userId       String           @map("user_id")
  instructorId String           @map("instructor_id")
  status       AttendanceStatus @default(PRESENT)
  checkedInAt  DateTime?        @map("checked_in_at")
  checkedOutAt DateTime?        @map("checked_out_at")
  duration     Int?
  notes        String?
  createdAt    DateTime         @default(now()) @map("created_at")
  updatedAt    DateTime         @updatedAt @map("updated_at")
  booking      Booking          @relation("BookingAttendance", fields: [bookingId], references: [id], onDelete: Cascade)
  class        Class            @relation(fields: [classId], references: [id], onDelete: Cascade)
  instructor   Instructor       @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  user         User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([classId])
  @@index([instructorId])
  @@index([userId])
  @@index([status])
  @@map("class_attendance")
}

model StudentFeedback {
  id               String     @id @default(cuid())
  bookingId        String     @unique @map("booking_id")
  classId          String     @map("class_id")
  userId           String     @map("user_id")
  instructorId     String     @map("instructor_id")
  overallRating    Int
  teachingRating   Int
  contentRating    Int
  engagementRating Int
  difficultyRating Int
  paceRating       Int
  comment          String?
  wouldRecommend   Boolean    @default(true) @map("would_recommend")
  isPublic         Boolean    @default(false) @map("is_public")
  createdAt        DateTime   @default(now()) @map("created_at")
  updatedAt        DateTime   @updatedAt @map("updated_at")
  booking          Booking    @relation("BookingFeedback", fields: [bookingId], references: [id], onDelete: Cascade)
  class            Class      @relation(fields: [classId], references: [id], onDelete: Cascade)
  instructor       Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  user             User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([classId])
  @@index([instructorId])
  @@index([userId])
  @@index([overallRating])
  @@map("student_feedback")
}

model InstructorPerformance {
  id                 String     @id @default(cuid())
  instructorId       String     @map("instructor_id")
  period             String
  periodStart        DateTime   @map("period_start")
  periodEnd          DateTime   @map("period_end")
  totalClasses       Int        @default(0) @map("total_classes")
  totalStudents      Int        @default(0) @map("total_students")
  totalHours         Float      @default(0) @map("total_hours")
  averageRating      Float?     @map("average_rating")
  attendanceRate     Float      @default(0) @map("attendance_rate")
  completionRate     Float      @default(0) @map("completion_rate")
  retentionRate      Float      @default(0) @map("retention_rate")
  newStudents        Int        @default(0) @map("new_students")
  returningStudents  Int        @default(0) @map("returning_students")
  totalRevenue       Decimal    @default(0) @map("total_revenue") @db.Decimal(10, 2)
  averageClassSize   Float      @default(0) @map("average_class_size")
  noShows            Int        @default(0) @map("no_shows")
  cancellations      Int        @default(0) @map("cancellations")
  feedbackCount      Int        @default(0) @map("feedback_count")
  recommendationRate Float      @default(0) @map("recommendation_rate")
  createdAt          DateTime   @default(now()) @map("created_at")
  updatedAt          DateTime   @updatedAt @map("updated_at")
  instructor         Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)

  @@unique([instructorId, period, periodStart])
  @@index([instructorId])
  @@index([period])
  @@index([periodStart])
  @@map("instructor_performance")
}

model StudentEngagement {
  id                  String          @id @default(cuid())
  userId              String          @map("user_id")
  instructorId        String          @map("instructor_id")
  classId             String          @map("class_id")
  bookingId           String          @unique @map("booking_id")
  engagementLevel     EngagementLevel @default(NEUTRAL)
  participationScore  Int             @default(0) @map("participation_score")
  attentionScore      Int             @default(0) @map("attention_score")
  improvementProgress Float           @default(0) @map("improvement_progress")
  questionsAsked      Int             @default(0) @map("questions_asked")
  helpRequested       Int             @default(0) @map("help_requested")
  practiceTime        Int             @default(0) @map("practice_time")
  strugglingAreas     String?         @map("struggling_areas")
  strengths           String?
  notes               String?
  createdAt           DateTime        @default(now()) @map("created_at")
  updatedAt           DateTime        @updatedAt @map("updated_at")
  booking             Booking         @relation("BookingEngagement", fields: [bookingId], references: [id], onDelete: Cascade)
  class               Class           @relation(fields: [classId], references: [id], onDelete: Cascade)
  instructor          Instructor      @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  user                User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([instructorId])
  @@index([classId])
  @@index([engagementLevel])
  @@map("student_engagement")
}

model ClassAnalytics {
  id                  String     @id @default(cuid())
  classId             String     @map("class_id")
  instructorId        String     @map("instructor_id")
  date                DateTime
  totalBookings       Int        @default(0) @map("total_bookings")
  actualAttendees     Int        @default(0) @map("actual_attendees")
  noShows             Int        @default(0) @map("no_shows")
  lateArrivals        Int        @default(0) @map("late_arrivals")
  earlyDepartures     Int        @default(0) @map("early_departures")
  averageDuration     Float      @default(0) @map("average_duration")
  energyLevel         Int        @default(0) @map("energy_level")
  difficultyLevel     Int        @default(0) @map("difficulty_level")
  paceRating          Float      @default(0) @map("pace_rating")
  studentSatisfaction Float      @default(0) @map("student_satisfaction")
  revenue             Decimal    @default(0) @map("revenue") @db.Decimal(10, 2)
  notes               String?
  weatherCondition    String?    @map("weather_condition")
  specialEvents       String?    @map("special_events")
  createdAt           DateTime   @default(now()) @map("created_at")
  updatedAt           DateTime   @updatedAt @map("updated_at")
  class               Class      @relation(fields: [classId], references: [id], onDelete: Cascade)
  instructor          Instructor @relation(fields: [instructorId], references: [id], onDelete: Cascade)

  @@unique([classId, date])
  @@index([classId])
  @@index([instructorId])
  @@index([date])
  @@map("class_analytics")
}

model LoginToken {
  id              String         @id @default(cuid())
  token           String         @unique
  name            String?
  purpose         String?
  createdByUserId String?        @map("created_by_user_id")
  maxUses         Int?           @map("max_uses")
  usedCount       Int            @default(0) @map("used_count")
  expiresAt       DateTime?      @map("expires_at")
  isActive        Boolean        @default(true) @map("is_active")
  allowedRoles    String[]       @map("allowed_roles")
  metadata        String?
  lastUsedAt      DateTime?      @map("last_used_at")
  lastUsedIp      String?        @map("last_used_ip")
  lastUserAgent   String?        @map("last_user_agent")
  createdAt       DateTime       @default(now()) @map("created_at")
  updatedAt       DateTime       @updatedAt @map("updated_at")
  loginAttempts   LoginAttempt[]
  createdByUser   User?          @relation("CreatedLoginTokens", fields: [createdByUserId], references: [id])

  @@index([token])
  @@index([createdByUserId])
  @@index([isActive])
  @@index([expiresAt])
  @@index([purpose])
  @@map("login_tokens")
}

model LoginAttempt {
  id            String     @id @default(cuid())
  tokenId       String     @map("token_id")
  email         String?
  success       Boolean
  failureReason String?    @map("failure_reason")
  ipAddress     String     @map("ip_address")
  userAgent     String?    @map("user_agent")
  userId        String?    @map("user_id")
  metadata      String?
  createdAt     DateTime   @default(now()) @map("created_at")
  token         LoginToken @relation(fields: [tokenId], references: [id], onDelete: Cascade)
  user          User?      @relation(fields: [userId], references: [id])

  @@index([tokenId])
  @@index([userId])
  @@index([success])
  @@index([createdAt])
  @@map("login_attempts")
}

model Host {
  id                 String              @id @default(cuid())
  userId             String              @unique @map("user_id")
  businessName       String              @map("business_name")
  businessType       String              @map("business_type")
  description        String?
  experienceYears    Int?                @map("experience_years")
  country            String
  city               String
  isVerified         Boolean             @default(false) @map("is_verified")
  isApproved         Boolean             @default(false) @map("is_approved")
  applicationStatus  HostApplicationStatus @default(PENDING) @map("application_status")
  rejectionReason    String?             @map("rejection_reason")
  approvedAt         DateTime?           @map("approved_at")
  approvedByUserId   String?             @map("approved_by_user_id")
  createdAt          DateTime            @default(now()) @map("created_at")
  updatedAt          DateTime            @updatedAt @map("updated_at")
  
  user               User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  approvedBy         User?               @relation("ApprovedHosts", fields: [approvedByUserId], references: [id])
  venues             Venue[]             @relation("HostVenues")
  classes            Class[]             @relation("HostClasses")
  events             Event[]             @relation("HostEvents")
  academies          Academy[]
  competitionRequests CompetitionRequest[]
  
  @@index([userId])
  @@index([isApproved])
  @@index([applicationStatus])
  @@index([country, city])
  @@map("hosts")
}

enum UserRole {
  USER
  INSTRUCTOR
  ADMIN
  HOST
}

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELLED
}

enum ClassStatus {
  DRAFT
  PUBLISHED
  CANCELLED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
  REFUNDED
}

enum PaymentProvider {
  STRIPE
  PAYPAL
  OTHER
}

enum TransactionType {
  PAYMENT
  REFUND
  ADJUSTMENT
}

enum TransactionStatus {
  CREATED
  SUCCEEDED
  FAILED
  REFUNDED
  CANCELLED
}

enum Proficiency {
  BEGINNER
  INTERMEDIATE
  ADVANCED
}

enum ExperienceLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  PROFESSIONAL
}

enum PartnerLookingFor {
  PRACTICE_PARTNER
  COMPETITION_PARTNER
  SOCIAL_PARTNER
  LEARNING_BUDDY
}

enum MatchStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  LEFT_EARLY
  EXCUSED
}

enum EngagementLevel {
  LOW
  NEUTRAL
  HIGH
}

enum HostApplicationStatus {
  PENDING
  APPROVED
  REJECTED
  SUSPENDED
}

enum VenueStatus {
  DRAFT
  PENDING_APPROVAL
  PUBLISHED
  REJECTED
}

enum CompetitionRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model SiteSettings {
  id                  String   @id @default(cuid())
  siteName            String   @map("site_name")
  siteDescription     String   @map("site_description")
  contactEmail        String   @map("contact_email")
  phoneNumber         String?  @map("phone_number")
  address             String?
  socialMedia         Json?    @map("social_media")
  footer              Json?
  createdAt           DateTime @default(now()) @map("created_at")
  updatedAt           DateTime @updatedAt @map("updated_at")

  @@map("site_settings")
}
